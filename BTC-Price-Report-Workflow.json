{\n  "name": "BTC Price Report",\n  "nodes": [\n    {\n      "parameters": {\n        "rule": {\n          "interval": [\n            {\n              "field": "hours",\n              "hoursInterval": 4\n            }\n          ]\n        }\n      },\n      "type": "n8n-nodes-base.scheduleTrigger",\n      "typeVersion": 1.2,\n      "position": [\n        -1344,\n        -448\n      ],\n      "id": "2c4ebdc4-fed9-4de3-8845-99eb092e6baf",\n      "name": "Schedule Trigger Node"\n    },\n    {\n      "parameters": {\n        "sendTo": "a.sametsoysal@gmail.com",\n        "subject": "🔔 Bitcoin Günlük Analiz Raporu",\n        "message": "={{ $json.emailContent }}",\n        "options": {}\n      },\n      "type": "n8n-nodes-base.gmail",\n      "typeVersion": 2.1,\n      "position": [\n        0,\n        -544\n      ],\n      "id": "cc90ccb8-1ca5-483d-afe0-e4175106dfd2",\n      "name": "Send a message",\n      "webhookId": "4688bc4a-6563-4fb0-b66b-2c745457f7a2",\n      "credentials": {\n        "gmailOAuth2": {\n          "id": "Sg4HFg13Dnt8L9Iu",\n          "name": "Gmail account"\n        }\n      }\n    },\n    {\n      "parameters": {\n        "jsCode": "// OpenRouter'dan gelen cevabı ve veri node'unu al\nconst llmResponse = $input.all()[0].json.choices[0].message.content;\nconst priceData = $node[\"Code Node(Veri İşleme)\"].json;\n\n// Tarih formatla\nconst currentDate = priceData.Tarih || new Date().toLocaleString('tr-TR');\n\n// Markdown işaretlerini HTML'e çevir (genişletilmiş)\nconst htmlLlmResponse = llmResponse\n  .replace(/\\*\\*\\*([^*]+)\\*\\*\\*/g, '<strong><em>$1</em></strong>')\n  .replace(/\\*\\*([^*]+)\\*\\*/g, '<strong>$1</strong>')\n  .replace(/\\*([^*]+)\\*/g, '<em>$1</em>')\n  .replace(/^### (.+)$/gm, '<h4>$1</h4>')\n  .replace(/^## (.+)$/gm, '<h3>$1</h3>')\n  .replace(/^# (.+)$/gm, '<h2>$1</h2>')\n  .replace(/^- (.+)$/gm, '• $1')\n  .replace(/^\\d+\. (.+)$/gm, '<strong>$1</strong>')\n  .replace(/\\n\\n/g, '</p><p>')\n  .replace(/\\n/g, '<br>')\n  .replace(/^/, '<p>')\n  .replace(/$/, '</p>');\n\n// Güvenli formatlama fonksiyonları\nconst formatPrice = (value) => {\n  if (!value || isNaN(value)) return 'N/A';\n  return `$${parseFloat(value).toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;\n};\n\nconst formatNumber = (value, decimals = 2) => {\n  if (!value || isNaN(value)) return 'N/A';\n  return parseFloat(value).toFixed(decimals);\n};\n\nconst formatPercent = (value) => {\n  if (value === null || value === undefined || isNaN(value)) return 'N/A';\n  const num = parseFloat(value);\n  const color = num > 0 ? '#28a745' : num < 0 ? '#dc3545' : '#6c757d';\n  const arrow = num > 0 ? '↑' : num < 0 ? '↓' : '→';\n  return `<span style=\"color: ${color}; font-weight: bold;\">${arrow} %${num.toFixed(2)}</span>`;\n};\n\nconst formatVolume = (value) => {\n  if (!value || isNaN(value)) return 'N/A';\n  const num = parseFloat(value);\n  if (num >= 1e9) return `${(num / 1e9).toFixed(2)}B`;\n  if (num >= 1e6) return `${(num / 1e6).toFixed(2)}M`;\n  if (num >= 1e3) return `${(num / 1e3).toFixed(2)}K`;\n  return num.toFixed(2);\n};\n\n// Trend göstergesi\nconst getTrendIndicator = (trend, strength) => {\n  const indicators = {\n    'Güçlü Yükseliş': '🚀',\n    'Yükseliş': '📈',\n    'Yatay': '➡️',\n    'Düşüş': '📉',\n    'Güçlü Düşüş': '⚠️'\n  };\n  const color = trend?.includes('Yükseliş') ? '#28a745' : \n                trend?.includes('Düşüş') ? '#dc3545' : '#6c757d';\n  return `<span style=\"color: ${color}; font-size: 1.2em;\">${indicators[trend] || '❓'} ${trend || 'Belirsiz'} (Güç: ${strength || 0}/5)</span>`;\n};\n\n// RSI durumu\nconst getRSIStatus = (rsi) => {\n  if (!rsi || isNaN(rsi)) return { text: 'N/A', color: '#6c757d' };\n  const value = parseFloat(rsi);\n  if (value >= 70) return { text: 'Aşırı Alım 🔴', color: '#dc3545' };\n  if (value >= 60) return { text: 'Güçlü 📈', color: '#ffc107' };\n  if (value >= 40) return { text: 'Nötr ➡️', color: '#6c757d' };\n  if (value >= 30) return { text: 'Zayıf 📉', color: '#ffc107' };\n  return { text: 'Aşırı Satım 🟢', color: '#28a745' };\n};\n\nconst rsiStatus = getRSIStatus(priceData.RSI14);\n\n// Sinyal durumu\nconst getSignalBadge = (signal, score) => {\n  const colors = {\n    'AL': '#28a745',\n    'SAT': '#dc3545',\n    'BEKLE': '#ffc107',\n    'NÖTR': '#6c757d'\n  };\n  const color = colors[signal] || '#6c757d';\n  return `<span style=\"background-color: ${color}; color: white; padding: 5px 10px; border-radius: 5px; font-weight: bold;\">${signal || 'BEKLE'} (${score || 0}/5)</span>`;\n};\n\n// Aktif sinyalleri formatla\nconst formatActiveSignals = (signals) => {\n  if (!signals || !Array.isArray(signals) || signals.length === 0) {\n    return '<li>Aktif sinyal bulunmuyor</li>';\n  }\n  return signals.map(s => `<li>${s}</li>`).join('');\n};\n\n// HTML formatında geliştirilmiş mail\nconst finalEmail = `\n<!DOCTYPE html>\n<html>\n<head>\n  <meta charset=\"UTF-8\">\n  <style>\n    body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; line-height: 1.6; color: #333; }\n    .container { max-width: 800px; margin: 0 auto; padding: 20px; }\n    .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; border-radius: 10px 10px 0 0; text-align: center; }\n    .header h1 { margin: 0; font-size: 28px; }\n    .header p { margin: 10px 0 0 0; opacity: 0.9; }\n    .content { background: white; padding: 30px; border: 1px solid #e0e0e0; border-radius: 0 0 10px 10px; }\n    .section { margin-bottom: 30px; }\n    .section h2 { color: #667eea; border-bottom: 2px solid #667eea; padding-bottom: 10px; margin-bottom: 20px; }\n    .section h3 { color: #764ba2; margin-top: 20px; }\n    .data-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin: 20px 0; }\n    .data-item { background: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 4px solid #667eea; }\n    .data-label { font-size: 12px; color: #6c757d; margin-bottom: 5px; }\n    .data-value { font-size: 18px; font-weight: bold; color: #212529; }\n    table { width: 100%; border-collapse: collapse; margin: 20px 0; }\n    th { background: #f8f9fa; padding: 12px; text-align: left; font-weight: 600; color: #495057; border-bottom: 2px solid #dee2e6; }\n    td { padding: 12px; border-bottom: 1px solid #dee2e6; }\n    .indicator-box { background: #f8f9fa; border-left: 4px solid #667eea; padding: 15px; margin: 15px 0; border-radius: 5px; }\n    .signal-box { background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); padding: 20px; border-radius: 10px; margin: 20px 0; }\n    .ai-analysis { background: #f0f4ff; border-left: 5px solid #4c6ef5; padding: 20px; margin: 20px 0; border-radius: 5px; }\n    .warning { background: #fff3cd; border-left: 4px solid #ffc107; padding: 15px; margin-top: 30px; border-radius: 5px; }\n    .footer { text-align: center; margin-top: 30px; padding-top: 20px; border-top: 1px solid #dee2e6; color: #6c757d; font-size: 12px; }\n    .badge { display: inline-block; padding: 5px 10px; border-radius: 5px; font-weight: bold; margin: 0 5px; }\n    .trend-up { color: #28a745; }\n    .trend-down { color: #dc3545; }\n    .trend-neutral { color: #6c757d; }\n  </style>\n</head>\n<body>\n  <div class=\"container\">\n    <div class=\"header\">\n      <h1>🤖 KRİPTO PARA ANALİZ RAPORU</h1>\n      <p>📅 ${currentDate} | Bitcoin (BTC/USDT) Detaylı Teknik Analiz</p>\n    </div>\n    \n    <div class=\"content\">\n      <div class=\"section\">\n        <h2>📊 PİYASA ÖZETİ</h2>\n        \n        <div class=\"data-grid\">\n          <div class=\"data-item\">\n            <div class=\"data-label\">💵 GÜNCEL FİYAT</div>\n            <div class=\"data-value\">${formatPrice(priceData.GuncelFiyat)}</div>\n          </div>\n          <div class=\"data-item\">\n            <div class=\"data-label\">📈 24 SAAT DEĞİŞİM</div>\n            <div class=\"data-value\">${formatPercent(priceData.Degisim24s)}</div>\n          </div>\n          <div class=\"data-item\">\n            <div class=\"data-label\">📊 24S HACİM (BTC)</div>\n            <div class=\"data-value\">${formatVolume(priceData.Hacim)}</div>\n          </div>\n          <div class=\"data-item\">\n            <div class=\"data-label\">💰 24S HACİM (USDT)</div>\n            <div class=\"data-value\">${formatVolume(priceData.HacimUSDT)}</div>\n          </div>\n        </div>\n        \n        <table>\n          <tr>\n            <th>📊 Metrik</th>\n            <th>📈 Değer</th>\n            <th>📊 Metrik</th>\n            <th>📈 Değer</th>\n          </tr>\n          <tr>\n            <td><strong>24s En Yüksek</strong></td>\n            <td>${formatPrice(priceData.EnYuksek24s)}</td>\n            <td><strong>24s En Düşük</strong></td>\n            <td>${formatPrice(priceData.EnDusuk24s)}</td>\n          </tr>\n          <tr>\n            <td><strong>Volatilite (24s)</strong></td>\n            <td>%${formatNumber(priceData.Volatilite24s)}</td>\n            <td><strong>ATR(14)</strong></td>\n            <td>${formatPrice(priceData.ATR14)}</td>\n          </tr>\n        </table>\n      </div>\n      \n      <div class=\"section\">\n        <h2>📈 TEKNİK İNDİKATÖRLER</h2>\n        \n        <div class=\"signal-box\">\n          <h3 style=\"margin-top: 0;\">🎯 Mevcut Durum</h3>\n          <p><strong>Trend:</strong> ${getTrendIndicator(priceData.Trend, priceData.TrendGucu)}</p>\n          <p><strong>Sinyal:</strong> ${getSignalBadge(priceData.Sinyal, priceData.SinyalPuani)}</p>\n          <p><strong>Aktif Sinyaller:</strong></p>\n          <ul style=\"margin: 10px 0;\">\n            ${formatActiveSignals(priceData.AktifSinyaller)}\n          </ul>\n        </div>\n        \n        <h3>📊 Hareketli Ortalamalar</h3>\n        <table>\n          <tr>\n            <th>Gösterge</th>\n            <th>Değer</th>\n            <th>Fiyat Pozisyonu</th>\n          </tr>\n          <tr>\n            <td><strong>SMA(20)</strong></td>\n            <td>${formatPrice(priceData.SMA20)}</td>\n            <td>${priceData.FiyatVsSMA20 || 'N/A'}</td>\n          </tr>\n          <tr>\n            <td><strong>SMA(50)</strong></td>\n            <td>${formatPrice(priceData.SMA50)}</td>\n            <td>${priceData.FiyatVsSMA50 || 'N/A'}</td>\n          </tr>\n          <tr>\n            <td><strong>SMA(200)</strong></td>\n            <td>${formatPrice(priceData.SMA200)}</td>\n            <td>${priceData.GuncelFiyat > priceData.SMA200 ? 'Üstünde ✅' : 'Altında ❌'}</td>\n          </tr>\n          <tr>\n            <td><strong>EMA(12)</strong></td>\n            <td>${formatPrice(priceData.EMA12)}</td>\n            <td rowspan=\"2\" style=\"vertical-align: middle;\">MACD: ${formatNumber(priceData.MACD)}</td>\n          </tr>\n          <tr>\n            <td><strong>EMA(26)</strong></td>\n            <td>${formatPrice(priceData.EMA26)}</td>\n          </tr>\n          <tr>\n            <td><strong>VWAP</strong></td>\n            <td>${formatPrice(priceData.VWAP)}</td>\n            <td>${priceData.FiyatVsVWAP || 'N/A'}</td>\n          </tr>\n        </table>\n        \n        <h3>📉 Momentum Göstergeleri</h3>\n        <div class=\"indicator-box\">\n          <p><strong>RSI(14):</strong> ${formatNumber(priceData.RSI14)} - <span style=\"color: ${rsiStatus.color}; font-weight: bold;\">${rsiStatus.text}</span></p>\n          <p><strong>Stochastic K:</strong> ${formatNumber(priceData.StochasticK)}</p>\n          <p><strong>MACD:</strong> ${formatNumber(priceData.MACD)} ${priceData.MACD > 0 ? '📈 Pozitif' : '📉 Negatif'}</p>\n        </div>\n        \n        <h3>📊 Bollinger Bantları</h3>\n        <table>\n          <tr>\n            <th>Bant</th>\n            <th>Seviye</th>\n            <th>Durum</th>\n          </tr>\n          <tr>\n            <td><strong>Üst Bant</strong></td>\n            <td>${formatPrice(priceData.BB_Ust)}</td>\n            <td rowspan=\"3\" style=\"vertical-align: middle;\">\n              Bant Genişliği: ${formatPrice(priceData.BB_Genislik)}<br>\n              ${priceData.GuncelFiyat > priceData.BB_Ust ? '⚠️ Üst Bandın Üstünde' : \n                priceData.GuncelFiyat < priceData.BB_Alt ? '⚠️ Alt Bandın Altında' : \n                '✅ Bantlar İçinde'}\n            </td>\n          </tr>\n          <tr>\n            <td><strong>Orta Bant</strong></td>\n            <td>${formatPrice(priceData.BB_Orta)}</td>\n          </tr>\n          <tr>\n            <td><strong>Alt Bant</strong></td>\n            <td>${formatPrice(priceData.BB_Alt)}</td>\n          </tr>\n        </table>\n      </div>\n      \n      <div class=\"section\">\n        <h2>🎯 KRİTİK SEVİYELER</h2>\n        \n        <div class=\"data-grid\">\n          <div class=\"data-item\" style=\"border-left-color: #dc3545;\">\n            <div class=\"data-label\">🔴 DİRENÇ 1</div>\n            <div class=\"data-value\">${formatPrice(priceData.Direnc1)}</div>\n          </div>\n          <div class=\"data-item\" style=\"border-left-color: #dc3545;\">\n            <div class=\"data-label\">🔴 ANA DİRENÇ</div>\n            <div class=\"data-value\">${formatPrice(priceData.Direnc)}</div>\n          </div>\n          <div class=\"data-item\" style=\"border-left-color: #ffc107;\">\n            <div class=\"data-label\">⚖️ PİVOT</div>\n            <div class=\"data-value\">${formatPrice(priceData.Pivot)}</div>\n          </div>\n          <div class=\"data-item\" style=\"border-left-color: #28a745;\">\n            <div class=\"data-label\">🟢 ANA DESTEK</div>\n            <div class=\"data-value\">${formatPrice(priceData.Destek)}</div>\n          </div>\n          <div class=\"data-item\" style=\"border-left-color: #28a745;\">\n            <div class=\"data-label\">🟢 DESTEK 1</div>\n            <div class=\"data-value\">${formatPrice(priceData.Destek1)}</div>\n          </div>\n        </div>\n      </div>\n      \n      <div class=\"section\">\n        <h2>🤖 AI DESTEKLİ ANALİZ VE STRATEJİ</h2>\n        \n        <div class=\"ai-analysis\">\n          ${htmlLlmResponse}\n        </div>\n      </div>\n      \n      <div class=\"warning\">\n        <strong>⚠️ ÖNEMLİ UYARI:</strong><br>\n        Bu rapor yalnızca bilgilendirme amaçlıdır ve yatırım tavsiyesi niteliği taşımaz. \n        Kripto para piyasaları yüksek volatiliteye sahiptir ve ani değişimler gösterebilir. \n        Yatırım kararlarınızı vermeden önce kendi araştırmanızı yapın ve risk yönetimi ilkelerini uygulayın.\n      </div>\n      \n      <div class=\"footer\">\n        <p>🔄 Bu rapor otomatik sistem tarafından oluşturulmuştur</p>\n        <p>📧 Sorularınız için destek ekibiyle iletişime geçebilirsiniz</p>\n        <p>© 2025 Kripto Analiz Sistemi | Tüm hakları saklıdır</p>\n      </div>\n    </div>\n  </div>\n</body>\n</html>\n`;// Çıktı objesi\nreturn [{\n  json: {\n    emailContent: finalEmail,\n    llmAnalysis: llmResponse,\n    priceData: priceData,\n    metadata: {\n      generatedAt: new Date().toISOString(),\n      symbol: priceData.Symbol || 'BTCUSDT',\n      currentPrice: priceData.GuncelFiyat,\n      trend: priceData.Trend,\n      signal: priceData.Sinyal,\n      rsi: priceData.RSI14,\n      support: priceData.Destek,\n      resistance: priceData.Direnc\n    }\n  }\n}];"\n      },\n      "type": "n8n-nodes-base.code",\n      "typeVersion": 2,\n      "position": [\n        -224,\n        -544\n      ],\n      "id": "2dc28bba-7aff-4b6a-a102-4e3216781789",\n      "name": "Code Node(LLM Cevap İşleme)"\n    }\n  ]\n}